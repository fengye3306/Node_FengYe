


## 三维空间坐标系性质

其实，就是一句话就能全部概括刚体运动：**左乘一个矩阵表示线性变化。**

> 描述不同坐标系中相同点的位置 

*空间本混沌一片，有坐标系才有坐标* 

![坐标系之间的关系](./img/00_kinematics/0.png ':size=300')

对于空间中定点@P@，其在坐标系A下的表达为@A_P@，在坐标系B下的表达为@B_P@ ,是否存在一个关系 @\xi^AB@（@\xi@：/ksaɪ/ ）使得有如下代数表达：  

@@
A_P =  \xi^AB \cdot B_P
@@

在这里，我们猜测，坐标系之间存在某种神奇的**关系**，这种关系使得可以将空间对于@B@坐标系下的表达转换到@A@坐标系下的表达。


> 坐标系间相对关系性质

1. **可叠加性**

![可叠加性](./img/00_kinematics/1.png ':size=300')

坐标系@A@与坐标系@B@存在一个关系，坐标系@C@与坐标系@B@也存在一个关系，则应该存在如下代数表达式：  

@@
\xi^AC =  \xi^AB \circ \xi^BC
@@

这里描述额是空间关系的叠加性质@\circ@符号表达的是**叠加**。   


@@
A_P =  \xi^AC \cdot C_P =  \left( \xi^AB \circ \xi^BC \right) \cdot C_P
@@


2. **可倒逆性**

如果坐标系B对于坐标系A存在关系@\xi^BA@ ，那么坐标系A对于坐标系B也应该存在关系@\xi^AB@，因为坐标系之间的关系是相对的。   
这里的代数式表达应该满足：  
@@
\xi^AB \circ \xi^BA = 1  
@@

两个相对关系叠加应该相当于，不作用。表达为@1@，这里的数字@1@暂时表达的是一个抽象概念————**不变**。      




## DH表示法

*Denavit-Hartenberg（DH）表示法是一种系统化的方法，用于描述和分析机械臂及其他多关节机器人系统的几何结构和运动学特性。由法国工程师Jacques Denavit和理查德 Hartenberg在1955年提出。*   

![一般杆件的关节坐标系](./img/00_kinematics/6.png ':size=300')     

*注意看清，阿尔法和a的区别，两个长得有点像*

* **连杆长度** @a_{i-1}@：表示两个关节之间的距离，是沿着前一个连杆的 x 轴的平移量。   
    以@x_{i-1}@方向看@z_{i-1}@和@z_i@之间的距离   

* **连杆扭角** @\alpha_{i-1}@：表示两个关节之间的相对扭转角度，是沿着 x 轴的旋转角度。   
    以@x_{i-1}@方向看，@z_{i-1}@和@z_i@之间的夹角（@ai>0@）   

* **关节偏移** @d_i@：表示关节沿着 z 轴的位移量。   
    沿着@z_i@方向看，@x_{i-1}@和@x_i@之间的距离。   

* **关节角度** @\theta_i@：表示关节绕着 z 轴的旋转角度。   
    沿着@z_i@方向看，@x_{i-1}@和@x_i@之间的夹角。     



**而想要使用这套DH表示法的前提也正是需要建立机械臂的各个关节的关节极坐标，这个极坐标需要用固定的方式推导，如下一一介绍之。**   

### Craig DH 关节坐标系推导

> 非特殊杆件关节坐标系的建立

在此处讨论的非特殊杆件，是指除去地杆（link0）和末端杆之外的中间连杆。     

![一般杆件的关节坐标系](./img/00_kinematics/4.png ':size=300')    

1. **确定关节坐标系的 Z 轴**  
关节坐标系的 Z 轴通过关节的运动特性确定，机器人关节主要分为两类，每类都有其固定的轴线定义：   

`旋转关节（Revolute Joint）`：       
定义：允许机器人部件围绕固定轴旋转的关节。   
轴线：旋转关节的轴线是其旋转运动的中心线（如图所示），通常与局部坐标系的 Z 轴重合，方向可以自行选择。     
`移动关节（Prismatic Joint）`：       
定义：允许机器人部件沿固定方向线性移动的关节。    
轴线：移动关节的轴线为其线性运动的方向，通常与局部坐标系的 Z 轴重合，方向可以自行选择。  

2. **确定关节坐标系的 X 轴**    
在确定 Z 轴之后，可以依据相邻关节的 Z 轴来定义 X 轴。X 轴被定义为两相邻关节的 Z 轴之间的垂直线。如图所示，关节 i-1 的 X 轴沿着参数@a_{i-1}@的方向。由此，Z 轴和 X 轴的交点形成关节坐标系的原点。   

如果两个关节的z轴平行，那么它们之间就有无数条公垂线。  
这时可挑选与下一关节的公垂线共线的一条公垂线， 这样做可以简化模型（关节距d为0）。  

![两轴相交](./img/00_kinematics/5.png ':size=300')       
当两 Z 轴相交时，即@a_{i-1}@为 0 的情况下，这时可将**垂直于两条轴线构成的平面的直线**指定为x轴。  



3. **确定关节坐标系的 Y 轴**     

Y 轴的方向通过右手定则确定，即右手大拇指指向 X 轴，食指指向 Z 轴，此时中指的方向即为 Y 轴方向。如图所示。

> 特殊杆件的处理   

对于地杆（link 0）和末端杆（end-effector），坐标系的建立方式略有不同，需分别处理。  

1.  地杆（link 0）  

地杆是机械臂的固定基座，其坐标系在关节变@\theta_1=0°@时与第一个关节（link 1）的坐标系重合。  
即直接取关节一处于@\theta_1=0°@状态时的关节一坐标系。

2. 末端杆（end-effector）

末端杆（n）无法确定X轴，其X轴取（n-1）轴同向延伸。   

> Craig DH表达法转仿射变换矩阵  

![DH转换仿射变换矩阵](./img/00_kinematics/7.png ':size=300')      
 
本质是连续四次空间变换的拟合，使得获得@n-1@轴到@n@轴的空间变换关系。    



### 深入理解DH表示法

DH表示法的四个数描述了当前轴的关节坐标系，如何被上一个轴的关节坐标系所描述。    
换句话说上一个轴的关节坐标系经过怎样的空间变换和当前轴的关节坐标系重合？     

设@A_{n-1}@坐标系，设@A_{n}@坐标系，如何记录@A_{n-1}@坐标系到@A_{n}@坐标系的**关系**？  
先思考旋转姿态关系，只需要思考如何旋转使得两坐标系的X轴 与Z轴两两平行。   

1. 沿着@X_{n-1}@轴方向旋转@Z_{n-1}@轴，使得@Z_{n-1}@与@Z_{n}@平行。   
你说，凭啥有解？？？因为，这个@X_{n-1}@轴同时垂直于两个坐标系的@Z@呀，建立关节坐标系的时候就是这么设计的，那确实有解！    
这个旋转角度就是**连杆扭角**@\alpha_{i-1}@。同时你还会发现，@X_{n-1}@，@X_{n}@，@Z_{n-1}@，@Z_{n}@ 四线共面。           

2. 沿着@Z_{n-1}@轴旋转@X_{n-1}@轴 使得@X_{n-1}@  轴与@X_{n}@  轴平行。   
这个旋转角度就是**关节角度** @\theta_i@。   

好了，就这么XZ平行，双方姿态就完全相同了！            
你说，不对呀！Y轴方向可能指向XZ平面分割空间的上面也可能指向XZ平面分割空间的令一面！凭什么对齐XZ两轴就对齐了两坐标系的姿态？    
**原因在于各个关节坐标系的Y轴的方向都依据X轴，Y轴右手定则所描述，因此Y轴的方向是统一而绝对确定的**     
     
好了，两次旋转，姿态对齐了对吧？ 同时你会发现，@X_{n-1}@，@X_{n}@，@Z_{n-1}@，@Z_{n}@ 四线共面。 这种情况下是不是只需要两次位移就可以完成两坐标系重合了？没错，这就是**关节偏移** @d_i@ 和**连杆长度** @a_{i-1}@ 。       

这两次旋转，两次平移 就是DH表示法的四个参数所由来了。   

其灵魂所在就是： 
1. @X_{n-1}@轴同时垂直于@A_{n-1}@和 @A_{n}@ 两坐标系的@Z@轴   
2. 所有关节坐标系的@Y@轴统一确立。   

**所以综上所述，DH表示法本质是一种既定规则下的数据压缩法，压缩的是两坐标系的变换关系。**   



## 正运动学（Forward Kinematics）  

*正运动学Forward Kinematics*   
![正运动学](./img/00_kinematics/8.png ':size=300')   

正运动学是指通过每个关节角度@\theta_{\text{jont}}@（jont，网页latex显示不清晰），计算末端执行器@p@的位置。    

### 减速比

在此过程中，还涉及一个关键问题，即驱动控制单元如何控制关节的运动。   

以马达为例，假设马达转动角度为@\theta_{\text{motor}} = 2^\circ@ （motor，网页latex显示不清晰）  
则关节的转动角度为@\theta_{\text{jont}} = 1^\circ@。     
这表明控制单元的转动与杆件的转动之间存在转换关系，这正是**齿轮比（减速比）**的概念由来。        
该过程的减速比可表示为：  

@@ 
\text{Gear Ratio} = \frac{\theta_{\text{joint}}}{\theta_{\text{motor}}}
@@   

这个例子中减速比@N@为:  
@@
\text{Gear Ratio} = \frac{1}{2} = 0.5
@@


## Inverse Kinematics   

*逆运动学Inverse Kinematics*     


> 求解概念 - workspace

![求解概念](./img/00_kinematics/11.png ':size=300')   

* **Reachable workspace**    
    手臂可以用一种以上的姿态到达的位置集合    
    
    如图机构@l_1 > l_2@，机构仅有Reachable workspace，为外环。   

* **Dexterous workspace**    
    手臂可以用任何的姿态到达的位置的集合，其是Reachable workspace的子集     

    如图机构@l_1 = l_2@，存在Reachable workspace 为机构原点，对于任意\theta_1@都存在@\theta_2@指向原点。   

> 求解概念 - Subspace   




