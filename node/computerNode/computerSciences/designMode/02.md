从设计一个**文档编辑器**软件的角度思考设计问题。   
这个笔记重点在于快速复习，不包含详细描述

### 文档结构

这里记录了怎么通过**组合模式**进行文档结构设计。  

![文档结构](./img/02/02_01.PNG ':size=WIDTHxHEIGHT')  

程序设计时脱离例如图像图元和文字图元的结构差异，不将文字作为特殊的图像，而是通过接口导向，即满足draw接口。   

脱离元素与元素组之间的差异，以操作元素的方式同样操作元素组。   



### 格式化

上一小节表征文档物理结构的表示，格式化描述如何构造文档结构。   
格式化描述的是一系列算法，算法将基础图元封装为行，行封装为段，段封装为文档。   

文档图元通过add接口将其他基础图元例如文字、图像加入自身形成最初始的图元组。再通过调用格式化算法构建出完备而合理的文档树。   

格式化算法直接写在文档图元类中则产生耦合，影响结构的可扩展性。    

![builder模式下的格式化功能分离](./img/02/02_02.PNG ':size=WIDTHxHEIGHT') 

通过**策略模式**，将格式化行为委派Compositor类。Compositor每一子类实现不同分行算法，通过遍历文档图元每一个子图元，分行算法将其插入结构图元。  


### 修饰用户界面

![修饰模式图元设计](./img/02/02_03.PNG ':size=WIDTHxHEIGHT') 
```c++
`void MonoGlyph::Draw (Window *w){
    // _component是被修饰的对象
    _component -> Draw(w);
}
```
![修饰图元实例](./img/02/02_04.PNG ':size=WIDTHxHEIGHT') 


### 支持多窗口系统  

通过**桥接模式**实现跨平台窗口系统。   
如果仅仅通过继承的方式完成跨平台会遇到的问题就是，类数量的爆炸，可扩展性的急剧下降。   

**桥接模式**通过将抽象与实现相分离完成结构精简。  

![跨平台窗口系统](./img/02/02_05.PNG ':size=WIDTHxHEIGHT') 


### 用户操作

希望**操作**应该被单独抽离，其既不和UI紧耦合又可以支持“撤销”，“重回”操作。   

> 监视者模式下的松耦合功能类

![功能系统](./img/02/02_06.PNG ':size=WIDTHxHEIGHT')    
松耦合的体系应该单独抽离操作，使其成为被封装的实体，使用**监视者模式**定义一个倒转依赖的Command类作为接口。   
对于方法，有相同的入口即Execute,而在执行期间，对于不同的Command派生类其拥有不同的各自实现。   

对于UI中的例如Menu，可以仅仅存放Command指针，再动态分配功能。   


> 撤销，重回的实现

撤销重回的操作通过**命令历史记录（Command Hisrory）**完成。   

以List<Command>链表存储用户操作记录，指针Command *parsent 指向链表的某一节点。  

当调用“撤销”行为时，实际调用Command::Unexecute,重回则本质就是Command::Execute。    

![撤销重回](./img/02/02_06.PNG ':size=WIDTHxHEIGHT')  



没有上述的监视者模式封装，撤销重回的操作就难以进行。 

更细节的实现详细，应该在回到本书中来查看。   

 

