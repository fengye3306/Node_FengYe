# tbb


## 从并发到并行  

> 摩尔定律的快车  

*集成电路上可容纳的晶体管数目每隔18到24个月就会增加一倍，同时，成本也会减少一半*。   
摩尔定律任然有效，晶体管数量的确在以指数级增长，但是cpu的主频却开始停止增长，甚至下降了  
（2001年8月个人电脑主频为2GHz，根据2003年趋势，2005年初cpu主频应该突破10GHz）   

![CPU](./img/tbb/01.png ':size=WIDTHxHEIGHT')

虽然狭义摩尔定律任然生效，但是单核性能并未因此产生同比指数级增长，**转而用于增加核心数量**。   
因此，多多对程序进行并行优化才能搭上摩尔定律的顺风车。    

> 2*3GHz < 6GHz 

一个双核心组成的6GHz的CPU实际并未完整的提供了6GHz的算力，其中为了保持缓存的一致性及其他握手协议的运行都增加了额外的运行时间开销，这个问题一直伴随CPU发展至今。   

> 并发与并行区别  


![并发](./img/tbb/02.png ':size=WIDTHxHEIGHT')
单核也能并发，单核并发的本质是单核运行多线程，CPU使用分时调度算法轮转执行不同线程，使得貌似在同时运行，  
其实这种单核并行的本质**并未超越单核性能**，也常用于使得界面**不阻塞**       
这种并发多数时间用在具体业务上，即类似假设单核CPU运行迅雷，执行下载任务的同时用户任然可以操作 GUI界面。     


![并行](./img/tbb/03.png ':size=WIDTHxHEIGHT')
并行在于单个CPU的多个核心，每个核心执行一个线程，使得达成真正的同时运行。  
并行优化的优化的本质 即是将 原本单核上运行的任务 如何负载均衡的使用多核心进行运行，从而更快的完成任务。    

> tbb并行优化本质   

tbb库识别cpu核心数量，基于核心数量创建对应数量线程，四核心即四线程。 之后，即使你分派了16个任务，tbb也只是把这16个任务负载均衡的分摊到各个核心上。   
tbb优化的本质就是轻量接口 并发分配任务，使得避除**单核有难多核围观**。   



