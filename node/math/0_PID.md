


## PID算法推导

PID是一种控制算法，其本质是 当得到系统的输出后，将输出经过**比例，积分，微分**3种运算方式，叠加到输入中，从而控制系统的行为。   

> 比例控制与比例控制局限性   

需求是使得某一水缸水位维持在1米高度，初始时刻水位0.2米，当前时刻与目标时刻存在误差值ERROR=1-0.2=0.8。假设此时存在一个人对水缸中进行注水。   
对于比例算法，加入的水量应当和ERROR值成成正比，即`U=kp*ERROR`。     

假定kp = 0.5。   
第一次加水量：0.4，水位上升至0.6.   
第二次加水量：0.2，水位上升至0.8.   
......   如此不断，就是比例控制算法    


**稳态误差**       
假设，水缸同时在漏水情况，如上比例控制存在一个时刻加入的水和流出的水相抵消使得水位终于不再变化，使得永远无法到达目标高度。   
在实际情况中，这种类似水缸漏水的情况往往更加常见，比如控制汽车运动，摩擦阻力就相当于是“漏水”，控制机械臂、无人机的飞行，各类阻力和消耗都可以理解为本例中的“漏水”。    

> 比例+积分控制（PI控制）    

上例，仅仅使用比例控制存在局限性。在控制中，我们再引入一个分量，该分量和误差的积分是正比关系。所以，比例+积分控制算法为：

@@
u = k_p \cdot \text{error} + k_i \cdot \int \text{error} \, dt
@@   

根据上问题，水缸漏水为每次加水后漏水0.1米，如下是模拟的加水过程。   

* 第一次加水   

误差 ：0.8米
积分项@e@ ：0.8米
控制量@u@ ：0.5×0.8 + 0.1×0.8 = 0.4+0.08 = 0.48米          
加水后水位 ：0.2 + 0.48 = 0.68 米  
漏水后水位 ：0.68 - 0.1 = 0.58 米     

* 第二次加水   

误差 ：0.42米  
积分项@e@ ：0.8+0.42 =1.22 米
控制量@u@ ：0.5×0.42+ 0.1×1.22 = 0.21+0.122=0.332 米  
加水后水位 ：0.58 + 0.332 = 0.912 米
漏水后水位 ：0.912 - 0.1 = 0.812 米

.......如此不断，就是比例+积分控制算法      

这个积分项会将前面若干次的误差进行累计，以消除**稳态误差**。       


> 比例+积分控制+微分控制（PID控制）    

面对远处红灯，为了使得行车平稳，司机提前几十米放松油门并踩刹车，当离停车线很近时则用力踩刹车使得车停下来使得没有越过停车线。    
引入的微分项则恰如此控制系统中刹车，作用在于防止系统过冲、减少系统震荡。      

* 连续时间PID

@@
u(t) = K_p e(t) + K_i \int_0^t e(\tau) \, d\tau + K_d \frac{de(t)}{dt}
@@


* 离散时间PID（完整形式）   

@@
u_k = K_p e_k + K_i \sum_{i=0}^k e_i \Delta t + K_d \frac{e_k - e_{k-1}}{\Delta t}
@@  

* 简化离散PID（Δt=1时）   

@@
u_k = K_p e_k + K_i \sum_{i=0}^k e_i + K_d (e_k - e_{k-1})
@@  


漏水模型，PID完整版：   

@K_p = 0.5@, @K_i = 0.1@, @K_d = 0.2@      

* **控制量公式**：@u_k = K_p e_k + K_i \sum e + K_d (e_k - e_{k-1})@     
* **漏水**：每次固定减少0.1m（风阻）    


| 次数 | 当前水位 | 误差 @e_k@ | 积分项 @\sum e@ | 微分项 @e_k - e_{k-1}@ | 控制量 @u_k@ | 加水后水位 | 漏水后水位 |
|------|----------|-------------|-------------------|--------------------------|----------------|------------|------------|
| 1    | 0.20     | 0.80        | 0.80              | 0 (初始)                 | @@0.5×0.8 + 0.1×0.8 + 0.2×0 = 0.48@@ | 0.68       | 0.58       |
| 2    | 0.58     | 0.42        | 1.22              | -0.38                    | @@0.5×0.42 + 0.1×1.22 + 0.2×(-0.38) ≈ 0.256@@ | 0.836      | 0.736      |
| 3    | 0.736    | 0.264       | 1.484             | -0.156                   | @@0.5×0.264 + 0.1×1.484 + 0.2×(-0.156) ≈ 0.249@@ | 0.985      | 0.885      |
| 4    | 0.885    | 0.115       | 1.599             | -0.149                   | @@0.5×0.115 + 0.1×1.599 + 0.2×(-0.149) ≈ 0.188@@ | 1.073      | 0.973      |
| 5    | 0.973    | 0.027       | 1.626             | -0.088                   | @@0.5×0.027 + 0.1×1.626 + 0.2×(-0.088) ≈ 0.159@@ | 1.132      | 1.032      |



